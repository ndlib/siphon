upstream app_service {
  server 127.0.0.1:3000;
}


server {
    listen 8080;
    server_name localhost;
    root /var/www/html;
}
server {
    listen 80;
    server_name localhost;
    client_max_body_size 4G;
    root /siphon/public;
    rails_env production;
    passenger_max_preloader_idle_time 0;

    # The following deploys your Ruby/Python/Node.js/Meteor app on Passenger.

    # Not familiar with Passenger, and used (G)Unicorn/Thin/Puma/pure Node before?
    # Yes, this is all you need to deploy on Passenger! All the reverse proxying,
    # socket setup, process management, etc are all taken care automatically for
    # you! Learn more at https://www.phusionpassenger.com/.
    passenger_enabled on;
    passenger_user app;

    # For Ruby 2.4
    passenger_ruby /usr/bin/ruby2.4;
  location / {
      proxy_pass http://app_service;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
  }    
}